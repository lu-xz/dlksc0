{"remainingRequest":"D:\\work\\dlksc\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\work\\dlksc\\src\\views\\dlksc\\abnormal.vue?vue&type=style&index=0&id=917a8a04&lang=scss&scoped=true&","dependencies":[{"path":"D:\\work\\dlksc\\src\\views\\dlksc\\abnormal.vue","mtime":1741570207233},{"path":"D:\\work\\dlksc\\node_modules\\css-loader\\dist\\cjs.js","mtime":1741571480126},{"path":"D:\\work\\dlksc\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1741571481712},{"path":"D:\\work\\dlksc\\node_modules\\postcss-loader\\src\\index.js","mtime":1741571480819},{"path":"D:\\work\\dlksc\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1741571479550},{"path":"D:\\work\\dlksc\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1741571479562},{"path":"D:\\work\\dlksc\\node_modules\\vue-loader\\lib\\index.js","mtime":1741571481108}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKQGltcG9ydCAiLi9zdHlsZS5zY3NzIjsK"},{"version":3,"sources":["abnormal.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8TA","file":"abnormal.vue","sourceRoot":"src/views/dlksc","sourcesContent":["<template>\r\n    <div class=\"main\">\r\n      <el-row>\r\n        <el-col :span=\"24\">\r\n          <div class=\"back\" @click=\"back\">返回</div>\r\n        </el-col>\r\n        <el-col :span=\"24\">\r\n          <div class=\"cc4\">\r\n            <div class=\"title4\">异常数据分析列表</div>\r\n            <el-form :model=\"abnormalParams\" ref=\"queryForm\" :inline=\"true\" label-width=\"88px\">\r\n                <el-form-item label=\"镇\" prop=\"town\">\r\n                    <el-select\r\n                    v-model=\"abnormalParams.town\"\r\n                    placeholder=\"全部\"\r\n                    clearable\r\n                    filterable\r\n                    :filter-method=\"handleFilter\"\r\n                    size=\"small\"\r\n                    style=\"width: 180px\"\r\n                    @change=\"changTown\"\r\n                    >\r\n                    <el-option\r\n                        v-for=\"dict in townOptions\"\r\n                        :key=\"dict.town\"\r\n                        :label=\"dict.town\"\r\n                        :value=\"dict.town\"\r\n                    />\r\n                    </el-select>\r\n                </el-form-item>\r\n                <el-form-item label=\"站点名称\" prop=\"siteName\">\r\n                    <el-input\r\n                    v-model=\"abnormalParams.siteName\"\r\n                    placeholder=\"请输入站点名称\"\r\n                    clearable\r\n                    size=\"small\"\r\n                    style=\"width: 240px\"\r\n                    @keyup.enter.native=\"handleQuery\"\r\n                    />\r\n                </el-form-item>\r\n            \r\n                <el-form-item label=\"异常类型\" prop=\"abnormalType\">\r\n                    <el-select\r\n                    v-model=\"abnormalParams.abnormalType\"\r\n                    placeholder=\"全部\"\r\n                    clearable\r\n                    size=\"small\"\r\n                    style=\"width: 240px\"\r\n                    @change=\"changeAbnormalType\"\r\n                    >\r\n                    <el-option\r\n                        v-for=\"dict in abnormalOptions\"\r\n                        :key=\"dict.dictValue\"\r\n                        :label=\"dict.dictLabel\"\r\n                        :value=\"dict.dictValue\"\r\n                    />\r\n                    </el-select>\r\n                </el-form-item>\r\n                <el-form-item>\r\n                    <el-button type=\"primary\" icon=\"el-icon-search\" size=\"mini\" @click=\"handleQuery(1)\">搜索</el-button>\r\n                    <el-button icon=\"el-icon-refresh\" size=\"mini\" @click=\"resetQuery\">重置</el-button>\r\n                    <el-button type=\"warning\" icon=\"el-icon-download\" size=\"mini\" @click=\"exportToExcel\">导出</el-button>\r\n                </el-form-item>\r\n            </el-form>\r\n            <div v-if=\"reason\" class=\"reason\">\r\n              <!-- <span class=\"suggest\">{{ abnormalParams.abnormalType === '7' ? '建议:':'异常原因分析:'}}</span> -->\r\n              <span class=\"suggest\">异常原因分析:</span>\r\n              {{ abnormalParams.abnormalType === '7'?'':'可能与'}}\r\n              <span class=\"reason-content\">{{ reason }}</span>\r\n              {{ abnormalParams.abnormalType === '7'?'':'等有关'}}\r\n            </div>\r\n            <el-table\r\n              :data=\"abnormalList\"\r\n              style=\"width: 100%\"\r\n              :header-cell-style=\"{\r\n                padding: '12px',\r\n                background: 'none',\r\n                color: '#fff',\r\n                fontWeight: '600',\r\n                fontSize: '16px',\r\n              }\"\r\n              v-loading=\"loading\"\r\n              element-loading-text=\"拼命加载中\"\r\n              element-loading-spinner=\"el-icon-loading\"\r\n              element-loading-background=\"rgba(0, 0, 0, 0.8)\"\r\n            >\r\n              <el-table-column\r\n                prop=\"siteName\"\r\n                label=\"站点名称\"\r\n                align=\"center\"\r\n                width=\"300\"\r\n                show-overflow-tooltip\r\n              >\r\n                <template slot-scope=\"scope\">\r\n                  <span @click=\"gotoXq(scope.row)\" style=\"cursor: pointer;\">{{scope.row.siteName}}</span>\r\n                </template>\r\n              </el-table-column>\r\n              <el-table-column\r\n                prop=\"abnormalType\"\r\n                label=\"异常类型\"\r\n                align=\"center\"\r\n                width=\"300\"\r\n                :formatter=\"abnormalTypeFormat\"\r\n                show-overflow-tooltip\r\n              >\r\n              </el-table-column>\r\n              <el-table-column\r\n                prop=\"dataRange\"\r\n                label=\"数据范围\"\r\n                align=\"center\"\r\n                width=\"200\"\r\n                show-overflow-tooltip\r\n              >\r\n              </el-table-column>\r\n              <!-- <el-table-column\r\n                prop=\"dealNum\"\r\n                label=\"处理量\"\r\n                align=\"center\"\r\n                width=\"200\"\r\n                show-overflow-tooltip\r\n              >\r\n              </el-table-column>\r\n              <el-table-column\r\n                prop=\"totalNum\"\r\n                label=\"用电量\"\r\n                align=\"center\"\r\n                width=\"200\"\r\n                show-overflow-tooltip\r\n              >\r\n              </el-table-column> -->\r\n              <el-table-column\r\n                prop=\"msg\"\r\n                label=\"异常说明\"\r\n                align=\"center\"\r\n                show-overflow-tooltip\r\n              >\r\n              </el-table-column>\r\n            </el-table>\r\n            <pagination\r\n              v-show=\"abnormalParams.total > 0\"\r\n              :total=\"abnormalParams.total\"\r\n              :page.sync=\"abnormalParams.pageNum\"\r\n              :limit.sync=\"abnormalParams.pageSize\"\r\n              @pagination=\"(page) => {pageChange(page,'abnormal');}\"\r\n            />\r\n          </div>\r\n        </el-col>\r\n      </el-row>\r\n    </div>\r\n  </template>\r\n  <script>\r\n  import { getAllAbnormalList, getTownList, exportData } from '@/api/dlkcw/index';\r\n  import PinyinMatch from 'pinyin-match';\r\n  export default {\r\n    data() {\r\n      return {\r\n        abnormalList: [],\r\n        loading: false,\r\n        abnormalParams: {\r\n          pageNum: 1,\r\n          pageSize: 10,\r\n          total: 0,\r\n          siteName: undefined,\r\n          abnormalType: undefined,\r\n          town: undefined,\r\n          list: [],\r\n          data: require(\"@/static/json/abnormal.json\")\r\n        },\r\n        abnormalOptions:[{\r\n          dictLabel:'有处理量但低（零）用电量',dictValue:'1',reason:'现场处理设备未启动或未完全启动、流量采集有问题、提供的户号数据有误、负荷未经过电能表'\r\n        },{\r\n          dictLabel:'有处理量但高用电量',dictValue:'2',reason:'现场处理设备异常启动、外部施工借电'\r\n        },{\r\n          dictLabel:'高处理量但低用电量',dictValue:'3',reason:'现场处理设备未启动或未完全启动、流量采集有问题、负荷未经过电能表'\r\n        },{\r\n          dictLabel:'处理量类似但用电量变化大',dictValue:'4',reason:'现场处理设备未按照流量需求进行启动、自动化控制策略过于激进'\r\n        },{\r\n          dictLabel:'处理量减少但用电量增加',dictValue:'5',reason:'现场处理设备未按照流量需求进行启动、自动化控制策略过于激进'\r\n        },{\r\n          dictLabel:'处理量增加但用电量减少',dictValue:'6',reason:'现场处理设备未按照流量需求进行启动、自动化控制策略过于激进'\r\n        },{\r\n          dictLabel:'处理量满负荷或超90%',dictValue:'7',reason:'需进行扩容改造'\r\n        }],\r\n        townData: require(\"@/static/json/townData.json\"),\r\n        townOptions:[],\r\n        initTownOptions: [],\r\n        reason: ''\r\n      };\r\n    },\r\n    created() {\r\n    \r\n    },\r\n    mounted() {\r\n      this.abnormalParams.town = localStorage.getItem('siteName');\r\n      this.getAbnormalList();\r\n      this.getTownList();\r\n    },\r\n    methods: {\r\n      getTownList(){\r\n        if(this.justIsStatic()){\r\n          this.townOptions = this.townData.map(item=>{\r\n            let json = {town: item.town}\r\n            return json;\r\n          });\r\n          this.initTownOptions = Object.assign(this.townOptions,{});\r\n        }else{\r\n          getTownList().then((res) => {\r\n            this.townOptions = res.data;\r\n            this.initTownOptions = Object.assign(this.townOptions,{});\r\n          })\r\n        }\r\n      },\r\n      justIsStatic(){\r\n        return JSON.parse(process.env.VUE_APP_IS_STATIC);\r\n      },\r\n      getAbnormalList(){\r\n        let pageNum = localStorage.getItem('pageNum');\r\n        pageNum = pageNum ? parseInt(pageNum) : 1;\r\n        localStorage.setItem('pageNum','');\r\n        if(this.justIsStatic()){\r\n          this.handleQuery(pageNum);\r\n        }else{\r\n          getAllAbnormalList().then((res) => {\r\n            this.abnormalParams.data = res.data;\r\n            this.handleQuery(pageNum);\r\n          })\r\n        }\r\n      },\r\n      pageChange(page, key) {\r\n        const pageNum = page.page;\r\n        this.dealData(pageNum, key);\r\n      },\r\n      dealData(pageNum, key) {\r\n        const data = this[key + \"Params\"].list;\r\n        const pageSize = this[key + \"Params\"].pageSize;\r\n        this[key + \"List\"] = data.slice((pageNum - 1) * pageSize, pageNum * pageSize);\r\n      },\r\n      changTown(){\r\n        this.townOptions = this.initTownOptions;\r\n      },\r\n      handleFilter(val) {\r\n        // 对绑定数据赋值\r\n        if (val) {\r\n          this.townOptions = this.initTownOptions.filter((item) => {\r\n            // 如果直接包含输入值直接返回true\r\n            if (item.town) {\r\n              if (\r\n                item.town.toUpperCase().indexOf(val.toUpperCase()) != -1\r\n              ) {\r\n                return true;\r\n              }\r\n              // 输入值拼音d\r\n              return PinyinMatch.match(item.town, val);\r\n            }\r\n          });\r\n        } else {\r\n          this.townOptions = this.initTownOptions;\r\n        }\r\n      },\r\n      abnormalTypeFormat(row){\r\n        return this.selectDictLabel(this.abnormalOptions,row.abnormalType);\r\n      },\r\n      /** 搜索按钮操作 */\r\n      handleQuery(pageNum) {\r\n        this.abnormalParams.pageNum = pageNum ? pageNum : 1;\r\n        let list = this.abnormalParams.data.filter(item=>{\r\n            if(!this.abnormalParams.siteName){\r\n                return true;\r\n            }\r\n            return item.siteName.indexOf(this.abnormalParams.siteName) > -1 || PinyinMatch.match(item.siteName, this.abnormalParams.siteName);\r\n        })\r\n        list = list.filter(item=>{\r\n            if(!this.abnormalParams.town){\r\n                return true;\r\n            }\r\n            return item.siteName.indexOf(this.abnormalParams.town) > -1\r\n        })\r\n        this.abnormalParams.list = list.filter(item=>{\r\n            if(!this.abnormalParams.abnormalType){\r\n                return true;\r\n            }\r\n            return item.abnormalType === this.abnormalParams.abnormalType;\r\n        })\r\n        this.abnormalParams.total = this.abnormalParams.list.length;\r\n        this.dealData(pageNum,'abnormal');\r\n      },\r\n      /** 重置按钮操作 */\r\n      resetQuery() {\r\n        this.dateRange = [];\r\n        this.resetForm(\"queryForm\");\r\n        this.handleQuery();\r\n      },\r\n      back(){\r\n        this.$router.push({name: \"Index\",params: { back: true }});\r\n      },\r\n      changeAbnormalType(){\r\n        if(this.abnormalParams.abnormalType){\r\n          let list = this.abnormalOptions.filter(item=> item.dictValue === this.abnormalParams.abnormalType)\r\n          this.reason = list[0].reason;\r\n        }else{\r\n          this.reason = ''\r\n        }\r\n      },\r\n      gotoXq(row){\r\n        localStorage.setItem('custNo', row.custNo);\r\n        localStorage.setItem('pageNum', this.abnormalParams.pageNum);\r\n        localStorage.setItem('abnormal', true);\r\n        this.$router.push({path: \"/dlkcw/xq\",query: { custNo: row.custNo }});\r\n      },\r\n      exportToExcel() {\r\n        const headers = ['站点名称', '异常类型', '数据范围', '异常说明']\r\n        const data = this.abnormalParams.list.map(item => [item.siteName, this.abnormalTypeFormat(item), item.dataRange,item.msg])\r\n        exportData(headers,data,'异常数据列表','异常数据');\r\n      }\r\n    },\r\n  };\r\n  </script>\r\n  \r\n  <style lang=\"scss\" scoped>\r\n  @import \"./style.scss\";\r\n  </style>"]}]}