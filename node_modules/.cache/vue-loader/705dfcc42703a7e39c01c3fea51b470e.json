{"remainingRequest":"C:\\Users\\陆小主\\Desktop\\dlkcw\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\陆小主\\Desktop\\dlkcw\\src\\views\\dlksc\\chart.vue?vue&type=style&index=0&id=c1b2dfd0&lang=scss&scoped=true&","dependencies":[{"path":"C:\\Users\\陆小主\\Desktop\\dlkcw\\src\\views\\dlksc\\chart.vue","mtime":1741570207238},{"path":"C:\\Users\\陆小主\\Desktop\\dlkcw\\node_modules\\css-loader\\dist\\cjs.js","mtime":1741571480126},{"path":"C:\\Users\\陆小主\\Desktop\\dlkcw\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1741571481712},{"path":"C:\\Users\\陆小主\\Desktop\\dlkcw\\node_modules\\postcss-loader\\src\\index.js","mtime":1741571480819},{"path":"C:\\Users\\陆小主\\Desktop\\dlkcw\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1741571479550},{"path":"C:\\Users\\陆小主\\Desktop\\dlkcw\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1741571479562},{"path":"C:\\Users\\陆小主\\Desktop\\dlkcw\\node_modules\\vue-loader\\lib\\index.js","mtime":1741571481108}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgpAaW1wb3J0ICIuL3N0eWxlLnNjc3MiOwo="},{"version":3,"sources":["chart.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgOA","file":"chart.vue","sourceRoot":"src/views/dlksc","sourcesContent":["<template>\r\n    <div>\r\n      <el-row style=\"margin-top:25px;\">\r\n        <el-col :span=\"24\">\r\n          <el-form :model=\"chartParams\" ref=\"queryForm\" :inline=\"true\" label-width=\"88px\">\r\n            <div class=\"back\" @click=\"back\">返回</div>\r\n            <el-form-item label=\"镇\" prop=\"town\">\r\n                <el-select\r\n                v-model=\"chartParams.town\"\r\n                placeholder=\"全部\"\r\n                clearable\r\n                filterable\r\n                :filter-method=\"handleFilter\"\r\n                size=\"small\"\r\n                style=\"width: 180px\"\r\n                @change=\"changTown\"\r\n                >\r\n                <el-option\r\n                    v-for=\"dict in townOptions\"\r\n                    :key=\"dict.town\"\r\n                    :label=\"dict.town\"\r\n                    :value=\"dict.town\"\r\n                />\r\n                </el-select>\r\n            </el-form-item>\r\n            <el-form-item label=\"站点名称\" prop=\"siteName\">\r\n              <el-input\r\n                v-model=\"chartParams.siteName\"\r\n                placeholder=\"请输入站点名称\"\r\n                clearable\r\n                size=\"small\"\r\n                style=\"width: 240px\"\r\n                @keyup.enter.native=\"handleQuery\"\r\n                />\r\n            </el-form-item>\r\n            <el-form-item>\r\n                <el-button type=\"primary\" icon=\"el-icon-search\" size=\"mini\" @click=\"handleQuery\" :disabled=\"loading\">搜索</el-button>\r\n            </el-form-item>\r\n        </el-form>\r\n        </el-col>\r\n      </el-row>\r\n      <div class=\"chartMain\">\r\n        <el-row v-for=\"(item,index) in mapData\" :key=\"index\">\r\n          <el-col :span=\"24\" style=\"padding: 20px 0\">\r\n              <el-row :gutter=\"20\">\r\n                <el-col :span=\"14\">\r\n                  <div class=\"yy\">\r\n                    <div class=\"title3\">{{ item.town + item.administrativeVillage + item.naturalVillage }} 日用电量曲线图</div>\r\n                    <PowerChart :id=\"'power'+ index\" :power=\"item.power\"></PowerChart>\r\n                  </div\r\n                ></el-col>\r\n                <el-col :span=\"10\">\r\n                  <div class=\"yy\">\r\n                    <div class=\"title3\">{{ item.town + item.administrativeVillage + item.naturalVillage }} 处理量、用电量统计图</div>\r\n                    <DealPowerChart :id=\"'dealPower'+ index\" :dealPower=\"item.dealPower\"></DealPowerChart>\r\n                  </div\r\n                ></el-col> </el-row\r\n            ></el-col>\r\n        </el-row>\r\n      </div>\r\n    </div>\r\n  </template>\r\n  <script>\r\n  import { getCwSiteList, getAllDealPowerList, getAllPowerList, getTownList } from '@/api/dlkcw/index';\r\n  import PinyinMatch from 'pinyin-match';\r\n  import PowerChart from \"./powerChart.vue\";\r\n  import DealPowerChart from \"./dealPowerChart.vue\";\r\n  export default {\r\n    components: {\r\n       PowerChart, DealPowerChart\r\n    },\r\n    data() {\r\n      return {\r\n        mapData: [],\r\n        finalMapData: [],\r\n        initMapData: require(\"@/static/json/cwSite.json\"),\r\n        initDealPowerList: require(\"@/static/json/dealPowerList.json\"),\r\n        initPowerList: require(\"@/static/json/power.json\"),\r\n        chartParams:{\r\n          siteName: undefined,\r\n          town: undefined,\r\n        },\r\n        townData: require(\"@/static/json/townData.json\"),\r\n        townOptions:[],\r\n        initTownOptions: [],\r\n        waiting: null,\r\n        loading: false,\r\n        hasPower: false,\r\n        hasDealPower: false\r\n      };\r\n    },\r\n    created() {},\r\n    mounted() {\r\n      // 静态页面直接加载\r\n      if(JSON.parse(process.env.VUE_APP_IS_STATIC)){\r\n        this.initMapData.forEach(item=>{\r\n           item.dealPower = this.initDealPowerList.find(d=> item.custNo === d.custNo) || {xData:[],dealData:[],powerData:[]}\r\n           item.power = this.initPowerList.find(d=> item.custNo === d.custNo) || {xData:[],yData:[]};\r\n        })\r\n        this.finalMapData = this.initMapData;\r\n        this.lazyLoad(this.finalMapData);\r\n        this.townOptions = this.townData.map(item=>{\r\n            let json = {town: item.town}\r\n            return json;\r\n          });\r\n        this.initTownOptions = Object.assign(this.townOptions);\r\n      }else{\r\n        const waiting = this.$loading({\r\n          lock: true,\r\n          text: '数据加载中，请稍后',\r\n          spinner: 'el-icon-loading',\r\n          background: 'rgba(0,0,0, 0.1)'\r\n        });\r\n        this.getMapData();\r\n        getTownList().then((res) => {\r\n          this.townOptions = res.data;\r\n          this.initTownOptions = Object.assign(this.townOptions);\r\n        })\r\n        let timer = setInterval(() => {\r\n          if(this.hasDealPower && this.hasPower){\r\n            waiting.close();\r\n            this.lazyLoad(this.finalMapData);\r\n            clearInterval(timer);\r\n          }\r\n        },50)\r\n      }\r\n      \r\n    },\r\n    methods: {\r\n      back(){\r\n        this.$router.push({name: \"Index\",params: { back: true }});\r\n      },\r\n      getMapData(){\r\n        getCwSiteList().then((res) => {\r\n            const siteList = res.data;\r\n            let list = []\r\n            siteList.forEach(item=>{\r\n                item.dealPower = {xData:[],dealData:[],powerData:[]};\r\n                item.power = {xData:[],yData:[]};\r\n                let json = {\"properties\":{\"adcode\":3203120001,\"value\":\"1\",\"level\":\"country\",\"center\":[item.lng,item.lat],\"name\":item.naturalVillage,\"address\":item.town + item.administrativeVillage + item.naturalVillage,\"dealNum\":item.dealNum,\"custNo\":item.custNo}\r\n                }\r\n                list.push(json)\r\n            })\r\n            console.log(list)\r\n            this.finalMapData = siteList;\r\n            this.getAllDealPowerList();\r\n            this.getAllPowerList();\r\n        })\r\n      },\r\n      getAllDealPowerList(){\r\n        getAllDealPowerList().then((res) => {\r\n          const initDealPowerList = res.data;\r\n          this.finalMapData.forEach(item=>{\r\n            item.dealPower = initDealPowerList.find(d=> item.custNo === d.custNo) || {xData:[],dealData:[],powerData:[]};\r\n          })\r\n          this.hasDealPower = true;\r\n        })\r\n      },\r\n      getAllPowerList(){\r\n        getAllPowerList().then((res) => {\r\n          const initPowerList = res.data;\r\n          this.finalMapData.forEach(item=>{\r\n            item.power = initPowerList.find(d=> item.custNo === d.custNo) || {xData:[],yData:[]};\r\n          })\r\n          this.hasPower = true;\r\n        })\r\n      },\r\n      changTown(){\r\n        this.townOptions = this.initTownOptions;\r\n      },\r\n      handleFilter(val) {\r\n        // 对绑定数据赋值\r\n        if (val) {\r\n          this.townOptions = this.initTownOptions.filter((item) => {\r\n            // 如果直接包含输入值直接返回true\r\n            if (item.town) {\r\n              if (\r\n                item.town.toUpperCase().indexOf(val.toUpperCase()) != -1\r\n              ) {\r\n                return true;\r\n              }\r\n              // 输入值拼音d\r\n              return PinyinMatch.match(item.town, val);\r\n            }\r\n          });\r\n        } else {\r\n          this.townOptions = this.initTownOptions;\r\n        }\r\n      },\r\n      /** 搜索按钮操作 */\r\n      handleQuery() {\r\n        this.mapData = [];\r\n        this.loading = true;\r\n        let list = this.finalMapData.filter(item=>{\r\n            if(!this.chartParams.siteName){\r\n                return true;\r\n            }\r\n            item.siteName = item.town + item.administrativeVillage + item.naturalVillage;\r\n            return item.siteName.indexOf(this.chartParams.siteName) > -1 || PinyinMatch.match(item.siteName, this.chartParams.siteName);\r\n        })\r\n        list = list.filter(item=>{\r\n            if(!this.chartParams.town){\r\n                return true;\r\n            }\r\n            return item.town === this.chartParams.town;\r\n        })\r\n        this.lazyLoad(list);\r\n      },\r\n      lazyLoad(list){\r\n        let count = 0;\r\n        this.loading = list.length > 0;\r\n        list.forEach(item=>{\r\n          setTimeout(() => {\r\n            count ++;\r\n            this.mapData.push(item);\r\n            this.loading = count < list.length;\r\n          }, 50);\r\n        })\r\n      }\r\n    },\r\n  };\r\n  </script>\r\n  \r\n  <style lang=\"scss\" scoped>\r\n  @import \"./style.scss\";\r\n  </style>"]}]}